<!DOCTYPE html>
<html lang="cs">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Audio Compressor by DJKvido</title>

    <!-- PWA Settings -->
    <meta name="theme-color" content="#0f172a">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-touch-icon" href="assets/icon.svg">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600&family=Outfit:wght@300;500;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="css/styles.css?v=9.2">
    <link rel="manifest" href="manifest.json">
</head>

<body>


    <div class="container">
        <!-- Upload Section -->
        <div class="upload-zone" id="uploadZone">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round"
                    d="M9 8.25H7.5a2.25 2.25 0 0 0-2.25 2.25v9a2.25 2.25 0 0 0 2.25 2.25h9a2.25 2.25 0 0 0 2.25-2.25v-9a2.25 2.25 0 0 0-2.25-2.25H15m0-3-3-3m0 0-3 3m3-3V15" />
            </svg>
            <h3 data-i18n="uploadTitle">P≈ôet√°hni sem audio soubor</h3>
            <p><span data-i18n="uploadOr">nebo</span> <span data-i18n="uploadBrowse">klikni pro v√Ωbƒõr</span> ‚Ä¢ <span
                    data-i18n="uploadFormats">MP3, WAV, M4A, OGG, FLAC</span></p>
            <input type="file" id="fileInput" accept="audio/*" multiple>
        </div>

        <p class="upload-hint-bottom" id="uploadHint" data-i18n="uploadHint"
            style="text-align: center; margin: 20px auto 30px; font-size: 0.75rem; color: #888; max-width: 550px; line-height: 1.5;">
        </p>

        <!-- File Info (shown after upload) -->
        <div class="file-info hidden" id="fileInfo">
            <div class="file-icon">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                    stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round"
                        d="m9 9 10.5-3m0 6.553v3.75a2.25 2.25 0 0 1-1.632 2.163l-1.32.377a1.803 1.803 0 1 1-.99-3.467l2.31-.66a2.25 2.25 0 0 0 1.632-2.163Zm0 0V2.25L9 5.25v10.303m0 0v3.75a2.25 2.25 0 0 1-1.632 2.163l-1.32.377a1.803 1.803 0 0 1-.99-3.467l2.31-.66A2.25 2.25 0 0 0 9 15.553Z" />
                </svg>
            </div>
            <div class="file-details">
                <h3 id="fileName">-</h3>
                <p id="fileMetadata">-</p>
            </div>
            <button class="remove-btn" id="removeFile" title="Odebrat soubor">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24"
                    stroke-width="1.5" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12" />
                </svg>
            </button>
        </div>

        <!-- Batch Queue Section (new) -->


        <!-- Batch List Section (Top) -->
        <div class="card hidden" id="batchListCard">
            <div class="card-header">
                <h2 data-i18n="batchTitle">üì¶ Batch Processing</h2>
                <div class="batch-actions">
                    <button class="btn btn-sm" id="clearBatch" data-i18n="clear">Clear</button>
                </div>
            </div>
            <div class="batch-list" id="batchList">
                <!-- Items will be injected here -->
            </div>
        </div>

        <!-- Analysis Section -->
        <div class="card hidden" id="analysisCard">
            <div class="card-header">
                <h2 data-i18n="analysisTitle">üìä Anal√Ωza p≈Øvodn√≠ho souboru</h2>
                <span class="badge original" data-i18n="originalBadge">ORIGIN√ÅL</span>
            </div>

            <div class="waveform-container">
                <canvas class="waveform-canvas" id="originalWaveform"></canvas>
                <div class="waveform-legend">
                    <div class="legend-item"><span class="legend-dot loud"></span> P≈ôebuzen√© (clipping)</div>
                    <div class="legend-item"><span class="legend-dot quiet"></span> P≈ô√≠li≈° tich√©</div>
                    <div class="legend-item"><span class="legend-dot ok"></span> V po≈ô√°dku</div>
                </div>
            </div>

            <div class="playback-controls">
                <button class="play-btn" id="playOriginal">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"
                        id="playIconOriginal">
                        <path fill-rule="evenodd"
                            d="M4.5 5.653c0-1.427 1.529-2.33 2.779-1.643l11.54 6.347c1.295.712 1.295 2.573 0 3.286L7.28 19.99c-1.25.687-2.779-.217-2.779-1.643V5.653Z"
                            clip-rule="evenodd" />
                    </svg>
                </button>
                <span class="time-display" id="timeOriginal">0:00 / 0:00</span>
                <div class="progress-bar" id="progressOriginal">
                    <div class="progress-bar-fill" id="progressFillOriginal"></div>
                </div>
            </div>

            <div class="analysis-box">
                <div class="analysis-title">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                        stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M3 13.125C3 12.504 3.504 12 4.125 12h2.25c.621 0 1.125.504 1.125 1.125v6.75C7.5 20.496 6.996 21 6.375 21h-2.25A1.125 1.125 0 0 1 3 19.875v-6.75ZM9.75 8.625c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125v11.25c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 0 1-1.125-1.125V8.625ZM16.5 4.125c0-.621.504-1.125 1.125-1.125h2.25C20.496 3 21 3.504 21 4.125v15.75c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 0 1-1.125-1.125V4.125Z" />
                    </svg>
                    <span data-i18n="analysisTitle">Anal√Ωza</span>
                </div>
                <div class="analysis-item">
                    <span class="label" data-i18n="rmsLabel">Pr≈Ømƒõrn√° hlasitost (RMS)</span>
                    <span class="value" id="rmsValue">-</span>
                </div>
                <div class="analysis-item">
                    <span class="label" data-i18n="peakLabel">≈†piƒçkov√° hlasitost (Peak)</span>
                    <span class="value" id="peakValue">-</span>
                </div>
                <div class="analysis-item">
                    <span class="label">Dynamick√Ω rozsah</span>
                    <span class="value" id="dynamicRange">-</span>
                </div>
                <div class="analysis-item">
                    <span class="label">D√©lka</span>
                    <span class="value" id="durationValue">-</span>
                </div>
            </div>
        </div>

        <!-- Settings Section -->
        <div class="card hidden" id="settingsCard">
            <div class="card-header">
                <h2 data-i18n="settingsTitle">Nastaven√≠</h2>
            </div>

            <!-- Simplified Interface -->
            <div class="settings-simple">
                <p class="settings-hint" data-i18n="settingsHint">Aplikace automaticky pou≈æije nejlep≈°√≠ nastaven√≠ pro
                    va≈°e audio.</p>

                <button class="btn btn-secondary settings-toggle-btn" id="toggleAdvancedSettings">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="3"></circle>
                        <path
                            d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z">
                        </path>
                    </svg>
                    <span data-i18n="advancedSettings">Pokroƒçil√© nastaven√≠</span>
                </button>
            </div>

            <!-- Advanced Settings (Collapsed) -->
            <div class="settings-content hidden" id="advancedSettingsContent">
                <div class="warning-box">
                    <span class="warning-icon">‚ö†Ô∏è</span>
                    <span data-i18n="advancedWarning">Pouze pro zku≈°en√© u≈æivatele. Zmƒõna hodnot m≈Ø≈æe zhor≈°it
                        v√Ωsledek.</span>
                </div>

                <div class="settings-layout">
                    <!-- Left column: Vyrovn√°n√≠ hlasitosti -->
                    <div class="setting-group setting-main">
                        <h4 data-i18n="volumeNormalization">Vyrovn√°n√≠ hlasitosti</h4>
                        <div class="checkbox-row">
                            <input type="checkbox" id="enableNormalize" checked>
                            <label for="enableNormalize">Aktivovat</label>
                        </div>

                        <div class="preset-selector">
                            <label data-i18n="presetLabel">Re≈æim:</label>
                            <select id="agcPreset">
                                <option value="light" data-i18n="presetLight">Jemn√© doladƒõn√≠</option>
                                <option value="standard" selected data-i18n="presetStandard">Standardn√≠</option>
                                <option value="heavy" data-i18n="presetHeavy">Agresivn√≠</option>
                                <option value="custom" data-i18n="presetCustom">Vlastn√≠</option>
                            </select>
                        </div>

                        <!-- Values always visible -->
                        <div class="preset-values" id="presetValues">
                            <div class="input-row">
                                <label data-i18n="targetRms">C√≠l RMS:</label>
                                <input type="number" id="targetRms" value="-14" min="-24" max="-6" step="1">
                                <span class="unit">dB</span>
                            </div>
                            <div class="input-row">
                                <label data-i18n="maxBoost">Max boost:</label>
                                <input type="number" id="maxBoost" value="20" min="6" max="30" step="1">
                                <span class="unit">dB</span>
                            </div>
                            <div class="input-row">
                                <label data-i18n="windowSize">Okno:</label>
                                <input type="number" id="windowSize" value="1000" min="300" max="3000" step="100">
                                <span class="unit">ms</span>
                            </div>
                        </div>
                    </div>

                    <!-- Right column: Limiter + Fades -->
                    <div class="settings-right">
                        <div class="setting-group">
                            <h4 data-i18n="limiter">Limiter</h4>
                            <div class="input-row">
                                <label data-i18n="limiterCeiling">Ceiling:</label>
                                <input type="number" id="limiterCeiling" value="-1" min="-6" max="0" step="0.1">
                                <span class="unit">dB</span>
                            </div>
                        </div>

                        <div class="setting-group">
                            <h4 data-i18n="fadeIn">Fade In</h4>
                            <div class="checkbox-row">
                                <input type="checkbox" id="enableFadeIn">
                                <label for="enableFadeIn" data-i18n="enable">Povolit</label>
                            </div>
                            <div class="input-row">
                                <label data-i18n="duration">D√©lka:</label>
                                <input type="number" id="fadeInTime" value="0" min="0" max="30" step="0.5">
                                <span class="unit" data-i18n="seconds">s</span>
                            </div>
                        </div>

                        <div class="setting-group">
                            <h4 data-i18n="fadeOut">Fade Out</h4>
                            <div class="checkbox-row">
                                <input type="checkbox" id="enableFadeOut">
                                <label for="enableFadeOut" data-i18n="enable">Povolit</label>
                            </div>
                            <div class="input-row">
                                <label data-i18n="duration">D√©lka:</label>
                                <input type="number" id="fadeOutTime" value="0" min="0" max="30" step="0.5">
                                <span class="unit" data-i18n="seconds">s</span>
                            </div>
                        </div>
                    </div>
                </div>


            </div>



        </div>

        <!-- Batch Actions (Inside Settings Card) -->
        <div class="actions hidden" id="batchProcessActions">
            <div id="batchStatusMsg" class="hidden"
                style="margin-bottom: 10px; color: var(--success); font-weight: bold;" data-i18n="batchFinished">
                Dokonƒçeno! ‚úÖ</div>
            <button class="btn btn-primary" id="processBatchBtn" data-i18n="processAll">Zpracovat v≈°e</button>
            <button class="btn btn-primary hidden" id="downloadBatchBtn" style="background: var(--success);"
                data-i18n="downloadZip">St√°hnout ZIP</button>
        </div>


        <!-- Solo Process Button (Outside Settings) -->
        <div class="actions" id="singleProcessActions" style="margin-bottom: 1rem;">
            <button class="btn btn-primary" id="processBtn">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2"
                    stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round"
                        d="M5.25 5.653c0-.856.917-1.398 1.667-.986l11.54 6.347a1.125 1.125 0 0 1 0 1.972l-11.54 6.347a1.125 1.125 0 0 1-1.667-.986V5.653Z" />
                </svg>
                <span data-i18n="processBtn">Zpracovat audio</span>
            </button>
        </div>

        <!-- Result Section -->
        <div class="card hidden" id="resultCard">
            <div class="card-header">
                <h2 data-i18n="resultTitle">‚úÖ V√Ωsledek zpracov√°n√≠</h2>
                <span class="badge processed" data-i18n="processedBadge">UPRAVENO</span>
            </div>

            <div class="tabs">
                <button class="tab" data-tab="processed" data-i18n="tabProcessed">Upraven√©</button>
                <button class="tab active" data-tab="compare" data-i18n="tabCompare">Porovn√°n√≠ p≈ôed/po</button>
            </div>

            <div id="processedTab" class="hidden">
                <div class="waveform-container">
                    <canvas class="waveform-canvas" id="processedWaveform"></canvas>
                </div>

                <div class="playback-controls">
                    <button class="play-btn" id="playProcessed">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"
                            id="playIconProcessed">
                            <path fill-rule="evenodd"
                                d="M4.5 5.653c0-1.427 1.529-2.33 2.779-1.643l11.54 6.347c1.295.712 1.295 2.573 0 3.286L7.28 19.99c-1.25.687-2.779-.217-2.779-1.643V5.653Z"
                                clip-rule="evenodd" />
                        </svg>
                    </button>
                    <span class="time-display" id="timeProcessed">0:00 / 0:00</span>
                    <div class="progress-bar" id="progressProcessed">
                        <div class="progress-bar-fill" id="progressFillProcessed"></div>
                    </div>
                </div>

                <div class="analysis-box">
                    <div class="analysis-title">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                            stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                d="M9 12.75 11.25 15 15 9.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
                        </svg>
                        <span data-i18n="whatChanged">Co se zmƒõnilo</span>
                    </div>
                    <div id="changesDescription">
                        <!-- Filled by JS -->
                    </div>
                </div>
            </div>

            <div id="compareTab">
                <!-- Original Section -->
                <div class="compare-container">
                    <div
                        style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 0.75rem;">
                        <h4 style="margin: 0; color: var(--warning);">‚ö†Ô∏è <span data-i18n="original">Origin√°l</span>
                        </h4>
                        <button class="nav-btn small" onclick="togglePlayback('original')" title="P≈ôehr√°t origin√°l">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
                                fill="currentColor" id="playIconOriginalComp">
                                <path fill-rule="evenodd"
                                    d="M4.5 5.653c0-1.427 1.529-2.33 2.779-1.643l11.54 6.347c1.295.712 1.295 2.573 0 3.286L7.28 19.99c-1.25.687-2.779-.217-2.779-1.643V5.653Z"
                                    clip-rule="evenodd" />
                            </svg>
                        </button>
                    </div>
                    <div class="waveform-container" onclick="togglePlayback('original')" style="cursor: pointer;">
                        <canvas class="waveform-canvas" id="compareOriginalWaveform"></canvas>
                    </div>
                    <p style="font-size: 0.8rem; color: var(--text-dim); margin-top: 0.5rem; text-align: center;"
                        id="originalStats"></p>
                </div>

                <!-- A/B Toggle Button (Middle) -->
                <div class="ab-toggle-container">
                    <button class="ab-toggle" id="abToggle"
                        title="P≈ôepnout mezi origin√°l a upravenou verz√≠ (stiskni bƒõhem p≈ôehr√°v√°n√≠)">
                        <span class="ab-label ab-a active">A</span>
                        <span class="ab-divider">|</span>
                        <span class="ab-label ab-b">B</span>
                    </button>
                    <span class="ab-hint" data-i18n="abHint">Klikni pro p≈ôepnut√≠ Origin√°l ‚Üî Upraveno</span>
                </div>

                <!-- Processed Section -->
                <div class="compare-container">
                    <div
                        style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 0.75rem;">
                        <h4 style="margin: 0; color: var(--accent);">‚úÖ <span data-i18n="processed">Upraveno</span>
                        </h4>
                        <button class="nav-btn small" onclick="togglePlayback('processed')" title="P≈ôehr√°t upraven√©">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
                                fill="currentColor" id="playIconProcessedComp">
                                <path fill-rule="evenodd"
                                    d="M4.5 5.653c0-1.427 1.529-2.33 2.779-1.643l11.54 6.347c1.295.712 1.295 2.573 0 3.286L7.28 19.99c-1.25.687-2.779-.217-2.779-1.643V5.653Z"
                                    clip-rule="evenodd" />
                            </svg>
                        </button>
                    </div>
                    <div class="waveform-container" onclick="togglePlayback('processed')" style="cursor: pointer;">
                        <canvas class="waveform-canvas" id="compareProcessedWaveform"></canvas>
                    </div>
                    <p style="font-size: 0.8rem; color: var(--text-dim); margin-top: 0.5rem; text-align: center;"
                        id="processedStats"></p>
                </div>
            </div>

            <div class="actions">
                <button class="btn btn-secondary" id="backBtn">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2"
                        stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M9 15 3 9m0 0 6-6M3 9h12a6 6 0 0 1 0 12h-3" />
                    </svg>
                    <span data-i18n="backBtn">Upravit nastaven√≠</span>
                </button>

                <div class="export-options">

                    <button class="btn btn-primary" id="downloadBtn">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2"
                            stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                d="M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3" />
                        </svg>
                        <span data-i18n="downloadBtn">St√°hnout MP3</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Processing Overlay -->
    <div class="processing-overlay" id="processingOverlay">
        <div class="processing-content">
            <div class="spinner"></div>
            <div class="processing-text" id="processingText">Zpracov√°v√°m...</div>
            <div class="processing-sub" id="processingSub">Aplikuji √∫pravy</div>
            <div class="progress-container">
                <div class="progress-bar" id="progressBar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <div class="progress-percent" id="progressPercent">0%</div>
            </div>
        </div>
    </div>

    <!-- Warning Modal -->
    <div class="modal-overlay" id="warningModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path
                            d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z">
                        </path>
                        <line x1="12" y1="9" x2="12" y2="13"></line>
                        <line x1="12" y1="17" x2="12.01" y2="17"></line>
                    </svg>
                    <span data-i18n="warningTitle" id="modalTitleText">D≈Øle≈æit√© upozornƒõn√≠</span>
                </h3>
            </div>
            <div class="modal-body">
                <p data-i18n="warningBody" id="modalBodyText">
                    Tento n√°stroj slou≈æ√≠ jako pomocn√≠k pro optimalizaci audia. Automatick√© √∫pravy nemus√≠ b√Ωt v≈ædy
                    perfektn√≠.
                    V≈ædy proveƒète fin√°ln√≠ kontrolu poslechem, abyste se ujistili, ≈æe v√Ωsledek odpov√≠d√° va≈°im p≈ôedstav√°m
                    a je optimalizov√°n spr√°vnƒõ.
                </p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="modalCancel" data-i18n="warningCancel">Zru≈°it</button>
                <button class="btn btn-primary" id="modalConfirm" data-i18n="warningConfirm">Rozum√≠m,
                    pokraƒçovat</button>
            </div>
        </div>
    </div>

    <footer>
        <div class="language-dropdown" id="languageDropdown">
            <button class="lang-btn" id="langBtn" aria-expanded="false" title="Zmƒõnit jazyk">
                <img src="https://flagcdn.com/24x18/cz.png" alt="CS" class="flag-icon" id="currentFlag">
                <span id="currentLangLabel">ƒåe≈°tina</span>
                <svg class="chevron" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="m6 9 6 6 6-6" />
                </svg>
            </button>
            <div class="lang-menu hidden" id="langMenu">
                <div class="lang-item" data-value="cs" onclick="changeLanguage('cs')">
                    <img src="https://flagcdn.com/24x18/cz.png" alt="CS" class="flag-icon">
                    <span>ƒåe≈°tina</span>
                </div>
                <div class="lang-item" data-value="en" onclick="changeLanguage('en')">
                    <img src="https://flagcdn.com/24x18/gb.png" alt="EN" class="flag-icon">
                    <span>English</span>
                </div>
                <div class="lang-item" data-value="de" onclick="changeLanguage('de')">
                    <img src="https://flagcdn.com/24x18/de.png" alt="DE" class="flag-icon">
                    <span>Deutsch</span>
                </div>
                <div class="lang-item" data-value="pl" onclick="changeLanguage('pl')">
                    <img src="https://flagcdn.com/24x18/pl.png" alt="PL" class="flag-icon">
                    <span>Polski</span>
                </div>
            </div>
        </div>
        <div style="display: flex; flex-direction: column; align-items: center; gap: 0.5rem;">
            <p><span data-i18n="footerText">Zpracov√°n√≠ prob√≠h√° v prohl√≠≈æeƒçi, soubory se nikam neodes√≠laj√≠</span></p>
            <button id="hardResetBtn" onclick="hardResetApp()"
                style="background: none; border: none; color: var(--text-tertiary); font-size: 0.7rem; cursor: pointer; text-decoration: underline; padding: 0.2rem;"
                title="Vymazat cache a aktualizovat aplikaci">
                ‚Üª Reset Cache & Reload (v9.2 Sync Fix)
            </button>
        </div>
    </footer>

    <!-- Inline Fix for Caching Issues -->
    <script>
        async function hardResetApp() {
            if (!confirm('Opravdu resetovat celou aplikaci? Vyma≈æe se cache a provede se tvrd√Ω reload.')) return;

            const btn = document.getElementById('hardResetBtn');
            btn.textContent = 'Resetov√°n√≠...';
            btn.style.color = 'var(--accent)';

            try {
                // 1. Kill Service Workers
                if ('serviceWorker' in navigator) {
                    const registrations = await navigator.serviceWorker.getRegistrations();
                    for (const registration of registrations) {
                        await registration.unregister();
                    }
                }

                // 2. Clear All Caches
                if ('caches' in window) {
                    const keys = await caches.keys();
                    await Promise.all(keys.map(key => caches.delete(key)));
                }

                // 3. Clear LocalStorage
                localStorage.clear();

                alert('Hotovo. Aplikace se nyn√≠ restartuje.');

                // 4. Force Reload
                window.location.reload(true);
                window.location.href = window.location.href; // Double force

            } catch (err) {
                alert('Chyba: ' + err.message);
                window.location.reload();
            }
        }
    </script>

    <!-- lamejs for MP3 encoding -->
    <script src="https://cdn.jsdelivr.net/npm/lamejs@1.2.1/lame.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

    <!-- Main Application (ES6 Module) -->
    <!-- Main Application (ES6 Module) -->
    <script type="module" src="js/app.js?v=9.2"></script>

    <!-- PWA Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('./sw.js')
                .then(() => console.log('Service Worker Registered'))
                .catch(err => console.error('SW Error:', err));
        }
    </script>
</body>

</html>